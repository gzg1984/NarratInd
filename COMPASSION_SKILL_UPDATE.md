# 同情天赋效果更新日志

## 更新时间
2024年（具体时间由系统记录）

## 更新概述
将同情天赋从"穷→富传播加成"改为"基于玩家财富值的动态效果系统"，使天赋更具策略性和风险/回报平衡。

## 新效果系统

### 1. 低财富传播加成（SE-COMPASSION-01）
**触发条件**: 玩家财富值 < 10

**效果**:
- 所有传播事件（selfSpread, attractDissatisfied, realHelp, crossBorder）概率 **×2.0**
- 首次触发时显示 **Level 3** 新闻

**新闻模板**:
```
"{country}的贫穷国民认为{star}帮助了他们度过困难时期。"
```

**策略意义**: 鼓励玩家在游戏前期保持低财富，最大化传播速度

---

### 2. 高财富传播惩罚（SE-COMPASSION-02）
**触发条件**: 玩家财富值 > 10

**效果**:
- 所有传播事件概率 **×0.5**
- 反对者（哲学家）出现概率 **×1.5**
- 反对者点击失败时显示专属新闻（替换原有的opponent_resist新闻）

**新闻模板**:
```
"{philosopher}认为{star}非常虚伪，利用着人们的同情心大肆敛财。"
```

**策略意义**: 惩罚过度积累财富的玩家，增加游戏难度和平衡性

---

### 3. 财富转移速度减半（SE-COMPASSION-03）
**效果**:
- 每回合从国家转移的财富 **×0.5**
- 差额返还给国家GDP（帮助国家恢复经济）

**计算公式**:
```javascript
原始转移量 = 国家GDP × 信徒占比 × 基础转移率
实际转移量 = 原始转移量 × 0.5
返还国家量 = 原始转移量 - 实际转移量

玩家财富 += 实际转移量
国家GDP += 返还国家量
```

**策略意义**: 
- 减缓财富增长速度，延长低财富加成期
- 帮助国家维持经济，减少GDP崩溃问题

---

## 文件修改清单

### 1. 核心配置文件
- **SKILL_EFFECTS_SPEC.md**: 更新同情天赋效果规范（SE-COMPASSION-01~03）
- **src/skills/skillNewsTemplates.js**: **新建**，存放所有技能相关新闻模板
- **src/skills/compassionEffects.js**: 完全重写，实现新的效果函数
- **src/skills/skillDescriptions.js**: 更新同情天赋描述文本

### 2. 管理器更新
- **src/skills/SkillEffectManager.js**:
  - 新增效果类型: `SPREAD_PROBABILITY`, `WEALTH_TRANSFER`
  - 移除已废弃方法: `shouldSkipGoodPersonEvent`
  - 新增方法: `shouldUseHypocrisyNews()`, `checkWealthNewsTrigger()`

### 3. 游戏逻辑整合
- **src/utils/gameState.js**:
  - `updateWealth()`: 应用财富转移修正，返还差额给国家
  - `checkWealthNews()`: **新增**，每回合检查财富状态并触发新闻
  - `processTurn()`: 集成新闻检查

- **src/data/events.js**:
  - `selfSpread`: 应用传播概率修正
  - `attractDissatisfied`: 应用传播概率修正
  - `realHelp`: 应用传播概率修正
  - `cross_border_spread`: 应用传播概率修正

### 4. 新闻系统扩展
- **src/components/NewsSystem.js**:
  - 导入 `skillNewsTemplates`
  - `selectTemplate()`: 支持技能新闻格式 `skill_<skillName>_<newsType>`
  - `getNewsLevel()`: 从技能新闻模板读取级别
  - `fillTemplate()`: 新增 `{philosopher}` 和 `{star}` 占位符支持

- **src/components/SpecialEvents.js**:
  - 反对者失败事件中检查是否使用高财富虚伪新闻

---

## 技术亮点

### 1. 财富状态追踪系统
```javascript
let wealthStateTracking = {
  lastState: null, // 'low' | 'high' | 'normal'
  lowWealthNewsTriggered: false,
  highWealthNewsTriggered: false
};
```
- 确保每种状态的新闻只触发一次
- 通过状态机模式管理财富变化

### 2. 新闻系统集成
- 使用命名约定 `skill_<skillName>_<newsType>` 自动路由
- 技能新闻独立存储，避免与主新闻系统混淆
- 支持从模板中读取新闻级别

### 3. 效果管理器架构
- 通过 `SkillEffectManager` 统一管理所有天赋效果
- 使用 `getSkillModifier(effectType, context)` 接口
- 文档化：所有效果算法在 SKILL_EFFECTS_SPEC.md 中定义

---

## 游戏平衡影响

### 前期（财富 < 10）
- ✅ 传播速度翻倍，快速感染初始区域
- ✅ 财富增长缓慢（转移减半），延长加成期
- 🎯 **策略**: 专注于传播，避免过早解锁好人事件增强财富

### 中期（财富 10-20）
- ⚖️ 正常传播速度
- ⚖️ 正常反对者概率
- 🎯 **策略**: 平衡传播与财富积累

### 后期（财富 > 20）
- ❌ 传播速度减半，扩张困难
- ❌ 反对者增多，防御压力大
- ⚠️ 特殊新闻暴露玩家"虚伪"形象
- 🎯 **策略**: 使用财富解锁其他天赋来缓解惩罚，或接受挑战

---

## 测试要点

### 功能测试
1. ✅ 财富 < 10 时，传播概率翻倍
2. ✅ 财富 > 10 时，传播概率减半 + 反对者概率增加
3. ✅ 财富转移减半，差额返还国家
4. ✅ 低财富首次触发新闻
5. ✅ 高财富反对者失败显示虚伪新闻

### UI测试
1. ✅ 天赋描述正确显示新效果
2. ✅ 技能新闻正确显示在新闻栏
3. ✅ 新闻级别正确（Level 3）

### 平衡测试
1. 低财富期传播速度是否合理
2. 高财富期惩罚是否过度
3. 财富转移减半对游戏节奏的影响

---

## 未来扩展方向

### 1. 其他天赋的财富互动
- 难民天赋：高财富时穷→富传播增强
- 奴隶制天赋：低财富时传播惩罚
- 逻辑天赋：财富影响好人事件收益

### 2. 财富区间细化
```javascript
if (wealth < 5) {
  // 极贫困：传播 ×3.0
} else if (wealth < 10) {
  // 贫困：传播 ×2.0
} else if (wealth > 30) {
  // 极富裕：传播 ×0.25
}
```

### 3. 新闻系统扩展
- 中财富状态新闻（10 < 财富 < 20）
- 财富阈值跨越动画效果
- 国家对玩家财富的评论

---

## 已移除功能

以下效果已从同情天赋中移除：

### SE-COMPASSION-03: 好人事件增强（荆棘王冠）❌
- 20%概率触发增强版好人事件
- 效果翻倍并转化脱教者
- **移除原因**: 与新财富系统冲突，过于复杂

### SE-COMPASSION-04: 固化国家事件优化 ❌
- 跳过已固化国家的普通好人事件
- **移除原因**: 依赖已移除的荆棘王冠系统

---

## 兼容性说明

### 向后兼容
- ✅ 旧的效果类型保留在 `SkillEffectTypes` 中（返回默认值）
- ✅ 天赋解锁逻辑不变
- ✅ 其他天赋不受影响

### 已知问题
- 无

---

## 更新者备注

这次更新大幅改变了同情天赋的核心机制，从简单的"穷→富加成"改为复杂的"财富状态系统"。新系统：

1. **更具策略性**: 玩家需要平衡传播速度与财富积累
2. **更有挑战性**: 高财富期的惩罚增加游戏难度
3. **更符合主题**: "同情"与"贫穷"的联系更加紧密
4. **更易扩展**: 新的财富状态系统可应用于其他天赋

建议在正式环境中充分测试财富阈值（10）的平衡性，必要时调整。
